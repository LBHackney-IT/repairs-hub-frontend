import { useContext } from 'react'
import PropTypes from 'prop-types'
import Link from 'next/link'
import UserContext from '../../UserContext/UserContext'
import cx from 'classnames'

import { HEADER_LINKS } from 'src/utils/headerLinks'

const HeaderComponent = ({ serviceName, toggleMobileMenu, mobileMenuOpen }) => {
  const { user } = useContext(UserContext)

  const headerLinks = () => {
    return HEADER_LINKS.map((link) => {
      if (link.permittedRoles.some((role) => user.roles.includes(role))) {
        return (
          <a id={link.id} href={`/${link.href}`}>
            {link.description}
          </a>
        )
      }
    })
  }

  const showHeaderLinks = () => {
    return user && <div className="lbh-header__links">{headerLinks()}</div>
  }

  const envNamefiltering = () => {
    if (
      process.env.NEXT_PUBLIC_ENV_NAME &&
      process.env.NEXT_PUBLIC_ENV_NAME.toLowerCase() !== 'production'
    ) {
      return (
        <div
          className={`lbh-body-m govuk-!-margin-0 env-name env-${process.env.NEXT_PUBLIC_ENV_NAME}`}
        >
          <span>{process.env.NEXT_PUBLIC_ENV_NAME.toUpperCase()}</span>
        </div>
      )
    }
  }

  const showDevelopmentNote = () => {
    if (
      process.env.NEXT_PUBLIC_ENV_NAME &&
      process.env.NEXT_PUBLIC_ENV_NAME.toLowerCase() == 'development'
    ) {
      return (
        <section className="text-for-env-note govuk-!-display-none-print">
          <div className="lbh-container">
            <h3>
              {`This is not live, this is a test environment`.toUpperCase()}
            </h3>
          </div>
        </section>
      )
    }
  }

  return (
    <>
      {showDevelopmentNote()}
      <a href="#main-content" className="govuk-skip-link lbh-skip-link">
        Skip to main content
      </a>
      <header
        className={`lbh-header govuk-!-display-none-print ${cx(
          process.env.NEXT_PUBLIC_ENV_NAME == 'staging'
            ? 'lbh-header--purple'
            : ''
        )}`}
      >
        <div className="lbh-header__main">
          <div className="lbh-container lbh-header__wrapper lbh-header__wrapper--stacked">
            <div className="lbh-header__title">
              <Link href="/">
                <a className="lbh-header__title-link">
                  <svg
                    className="lbh-header__logo"
                    role="presentation"
                    focusable="false"
                    width="208px"
                    height="37px"
                    viewBox="0 0 208 37"
                  >
                    <title>Hackney logo</title>
                    <g stroke="none" fill="currentColor" fillRule="evenodd">
                      <path d="M36,15.9985404 C36,9.03922642 32.0578091,3.00529101 26.2909886,0 L26.2909886,12.0328407 L9.70901142,12.0328407 L9.70901142,0 C3.94073354,3.00529101 0,9.03922642 0,15.9985404 C0,22.9607736 3.94073354,28.9961686 9.70901142,32 L9.70901142,19.9671593 L26.2909886,19.9671593 L26.2909886,32 C32.0578091,28.9961686 36,22.959314 36,15.9985404"></path>
                      <polyline points="42 1 50.8590247 1 50.8590247 11.1301668 59.1380971 11.1301668 59.1380971 1 68 1 68 30 59.1380971 30 59.1380971 18.5708703 50.8590247 18.5708703 50.8590247 30 42 30 42 1"></polyline>
                      <path d="M91.0145371,16.1849059 C91.0145371,12.1530391 91.0951926,8 80.9296736,8 C75.887975,8 70.2303622,8.96793653 69.9854629,14.8548948 L77.5274802,14.8548948 C77.5700077,13.9417743 78.0612726,12.6824471 80.5615914,12.6824471 C81.8711426,12.6824471 83.2246876,13.2089699 83.2246876,14.6327454 C83.2246876,15.9728542 82.1175083,16.2974231 81.0117955,16.5008196 C76.870505,17.2725723 69,17.028785 69,23.6889384 C69,28.0756672 72.4021933,30 76.5038893,30 C79.1259245,30 81.6247768,29.4359714 83.346404,27.5145236 L83.4299923,27.5145236 C83.3874649,28.0367189 83.5121143,28.8849256 83.7159526,29.4489542 L92,29.4489542 C91.0951926,28.116058 91.0145371,26.3403056 91.0145371,24.7679496 L91.0145371,16.1849059 Z M83.2246876,21.986755 C83.1015047,24.1635303 81.6687707,25.2526392 79.8224943,25.2526392 C78.3486993,25.2526392 77.2811145,24.2832601 77.2811145,23.3167661 C77.2811145,21.9059734 78.2255164,21.4631172 80.027799,21.0606518 C81.1335119,20.8197495 82.2406912,20.5355714 83.2246876,20.053767 L83.2246876,21.986755 L83.2246876,21.986755 Z"></path>
                      <path d="M106.908596,16.4807453 C106.823548,15.6320934 106.532598,14.9465328 105.989491,14.5149905 C105.489653,14.0719019 104.780928,13.8308732 103.905092,13.8308732 C100.735971,13.8308732 100.274927,16.4865184 100.274927,19.0223709 C100.274927,21.5567802 100.735971,24.1691268 103.905092,24.1691268 C105.697048,24.1691268 106.948881,22.7604802 107.115991,21.1136915 L115,21.1136915 C114.206228,26.8074526 109.577879,30 103.737982,30 C97.2236782,30 92,25.6383914 92,19.0165978 C92,12.4020206 97.2236782,8 103.737982,8 C109.409277,8 114.249497,10.7061602 114.749335,16.4807453 L106.908596,16.4807453"></path>
                      <polyline points="115 1 123.245818 1 123.245818 15.0160369 128.483831 8.93525108 137.794201 8.93525108 130.104448 16.8806756 139 30 129.106802 30 124.7014 22.3510574 123.245818 23.8959607 123.245818 30 115 30 115 1"></polyline>
                      <path
                        d="M139,8.55177515 L146.79367,8.55177515 L146.79367,11.2677515 L146.873792,11.2677515 C148.375712,9.1183432 150.528804,8 153.736591,8 C157.531453,8 161,10.3579882 161,15.285503 L161,30 L152.920805,30 L152.920805,18.7559172 C152.920805,16.2781065 152.63528,14.5414201 150.284068,14.5414201 C148.904516,14.5414201 147.077738,15.2426036 147.077738,18.6745562 L147.077738,30 L139,30 L139,8.55177515"
                        id="Fill-18"
                      ></path>
                      <path d="M185,20.7649334 C185,12.6088781 181.402905,8 173.076217,8 C166.446107,8 162,12.9305619 162,19.0338994 C162,26.0618976 167.055025,30 173.763237,30 C178.531883,30 182.938938,27.9097764 184.557414,23.411973 L177.076846,23.411973 C176.436109,24.4130877 175.020123,24.9064324 173.727078,24.9064324 C171.219092,24.9064324 169.845051,23.1811684 169.641114,20.7649334 L185,20.7649334 Z M169.684505,16.621992 C170.046095,14.3485673 171.420136,13.0906826 173.802289,13.0906826 C175.864797,13.0906826 177.318388,14.6731362 177.318388,16.621992 L169.684505,16.621992 L169.684505,16.621992 Z"></path>
                      <path d="M200.955311,28.5221077 C200.298901,30.3958684 199.56337,32.7989483 198.29304,34.3912803 C196.164103,37.0407925 192.887912,37 189.733333,37 L186.048352,37 L186.048352,30.5577263 L187.92967,30.5577263 C188.750183,30.5577263 189.813919,30.6408425 190.389744,30.3550393 C190.880586,30.1115234 191.1663,29.7032331 191.1663,28.7670818 C191.1663,27.7463561 188.054212,19.964052 187.604396,18.7406393 L184,9 L192.681319,9 L196.082051,21.1451774 L196.164103,21.1451774 L199.604396,9 L208,9 L200.955311,28.5221077"></path>
                    </g>
                    <image
                      src="/assets/images/lbh-logo.png"
                      xlinkHref=""
                      className="lbh-header__logo-fallback-image"
                      width="206"
                      height="37"
                    ></image>
                  </svg>
                  <span className="lbh-header__logo-text"> Hackney </span>
                  <span className="lbh-header__service-name">
                    {serviceName}
                  </span>
                </a>
              </Link>
            </div>
            {envNamefiltering()}
            {user && (
              <>
                {showHeaderLinks()}

                <div
                  className="burger govuk-!-margin-top-1"
                  onClick={toggleMobileMenu}
                >
                  {mobileMenuOpen ? (
                    <svg
                      width="35"
                      height="35"
                      viewBox="5 5 29.56 31.06"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M9.16312 6.67098L28.4552 25.963C28.865 26.3728 29.4234 26.4788 29.7024 26.1998L30.9656 24.9366C31.2447 24.6575 31.1387 24.0991 30.7289 23.6893L11.4368 4.39727C11.027 3.98746 10.4686 3.88148 10.1896 4.16054L8.92639 5.42371C8.64732 5.70278 8.7533 6.26116 9.16312 6.67098Z"
                        fill="white"
                      />
                      <path
                        d="M30.8942 6.49911L11.4992 25.894C11.0872 26.306 10.5152 26.4019 10.2214 26.1082L8.89182 24.7786C8.59808 24.4848 8.69394 23.9128 9.10594 23.5008L28.5009 4.10582C28.9129 3.69382 29.4849 3.59796 29.7787 3.8917L31.1083 5.22131C31.402 5.51505 31.3062 6.0871 30.8942 6.49911Z"
                        fill="white"
                      />
                      <path
                        d="M8.50413 36.06C7.8108 36.06 7.18413 35.9067 6.62413 35.6C6.0708 35.2933 5.63413 34.87 5.31413 34.33C5.0008 33.7833 4.84413 33.1733 4.84413 32.5C4.84413 31.8267 5.0008 31.22 5.31413 30.68C5.63413 30.1333 6.07413 29.7067 6.63413 29.4C7.19413 29.0933 7.8208 28.94 8.51413 28.94C9.03413 28.94 9.51413 29.0267 9.95413 29.2C10.3941 29.3733 10.7675 29.6267 11.0741 29.96L10.6041 30.43C10.0575 29.8767 9.36746 29.6 8.53413 29.6C7.9808 29.6 7.47746 29.7267 7.02413 29.98C6.5708 30.2333 6.21413 30.58 5.95413 31.02C5.7008 31.46 5.57413 31.9533 5.57413 32.5C5.57413 33.0467 5.7008 33.54 5.95413 33.98C6.21413 34.42 6.5708 34.7667 7.02413 35.02C7.47746 35.2733 7.9808 35.4 8.53413 35.4C9.37413 35.4 10.0641 35.12 10.6041 34.56L11.0741 35.03C10.7675 35.3633 10.3908 35.62 9.94413 35.8C9.50413 35.9733 9.02413 36.06 8.50413 36.06ZM12.1971 29H12.9371V35.36H16.8571V36H12.1971V29ZM20.5545 36.06C19.8612 36.06 19.2312 35.9067 18.6645 35.6C18.1045 35.2867 17.6645 34.86 17.3445 34.32C17.0312 33.78 16.8745 33.1733 16.8745 32.5C16.8745 31.8267 17.0312 31.22 17.3445 30.68C17.6645 30.14 18.1045 29.7167 18.6645 29.41C19.2312 29.0967 19.8612 28.94 20.5545 28.94C21.2478 28.94 21.8712 29.0933 22.4245 29.4C22.9845 29.7067 23.4245 30.1333 23.7445 30.68C24.0645 31.22 24.2245 31.8267 24.2245 32.5C24.2245 33.1733 24.0645 33.7833 23.7445 34.33C23.4245 34.87 22.9845 35.2933 22.4245 35.6C21.8712 35.9067 21.2478 36.06 20.5545 36.06ZM20.5545 35.4C21.1078 35.4 21.6078 35.2767 22.0545 35.03C22.5012 34.7767 22.8512 34.43 23.1045 33.99C23.3578 33.5433 23.4845 33.0467 23.4845 32.5C23.4845 31.9533 23.3578 31.46 23.1045 31.02C22.8512 30.5733 22.5012 30.2267 22.0545 29.98C21.6078 29.7267 21.1078 29.6 20.5545 29.6C20.0012 29.6 19.4978 29.7267 19.0445 29.98C18.5978 30.2267 18.2445 30.5733 17.9845 31.02C17.7312 31.46 17.6045 31.9533 17.6045 32.5C17.6045 33.0467 17.7312 33.5433 17.9845 33.99C18.2445 34.43 18.5978 34.7767 19.0445 35.03C19.4978 35.2767 20.0012 35.4 20.5545 35.4ZM27.3586 36.06C26.8386 36.06 26.3386 35.9767 25.8586 35.81C25.3853 35.6433 25.0186 35.4233 24.7586 35.15L25.0486 34.58C25.302 34.8333 25.6386 35.04 26.0586 35.2C26.4786 35.3533 26.912 35.43 27.3586 35.43C27.9853 35.43 28.4553 35.3167 28.7686 35.09C29.082 34.8567 29.2386 34.5567 29.2386 34.19C29.2386 33.91 29.152 33.6867 28.9786 33.52C28.812 33.3533 28.6053 33.2267 28.3586 33.14C28.112 33.0467 27.7686 32.9467 27.3286 32.84C26.802 32.7067 26.382 32.58 26.0686 32.46C25.7553 32.3333 25.4853 32.1433 25.2586 31.89C25.0386 31.6367 24.9286 31.2933 24.9286 30.86C24.9286 30.5067 25.022 30.1867 25.2086 29.9C25.3953 29.6067 25.682 29.3733 26.0686 29.2C26.4553 29.0267 26.9353 28.94 27.5086 28.94C27.9086 28.94 28.2986 28.9967 28.6786 29.11C29.0653 29.2167 29.3986 29.3667 29.6786 29.56L29.4286 30.15C29.1353 29.9567 28.822 29.8133 28.4886 29.72C28.1553 29.62 27.8286 29.57 27.5086 29.57C26.8953 29.57 26.432 29.69 26.1186 29.93C25.812 30.1633 25.6586 30.4667 25.6586 30.84C25.6586 31.12 25.742 31.3467 25.9086 31.52C26.082 31.6867 26.2953 31.8167 26.5486 31.91C26.8086 31.9967 27.1553 32.0933 27.5886 32.2C28.102 32.3267 28.5153 32.4533 28.8286 32.58C29.1486 32.7 29.4186 32.8867 29.6386 33.14C29.8586 33.3867 29.9686 33.7233 29.9686 34.15C29.9686 34.5033 29.872 34.8267 29.6786 35.12C29.492 35.4067 29.202 35.6367 28.8086 35.81C28.4153 35.9767 27.932 36.06 27.3586 36.06ZM36.0764 35.36V36H31.1264V29H35.9264V29.64H31.8664V32.13H35.4864V32.76H31.8664V35.36H36.0764Z"
                        fill="white"
                      />
                    </svg>
                  ) : (
                    <svg
                      width="35"
                      height="35"
                      viewBox="4.84 3.72 31.23 32.34"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fillRule="evenodd"
                        clipRule="evenodd"
                        d="M6.05559 8.67347H33.5011C34.0841 8.67347 34.5567 8.30801 34.5567 7.85714V5.81633C34.5567 5.36546 34.0841 5 33.5011 5H6.05559C5.47258 5 5 5.36546 5 5.81633V7.85714C5 8.30801 5.47258 8.67347 6.05559 8.67347ZM6.05559 16.8367H33.5011C34.0841 16.8367 34.5567 16.4713 34.5567 16.0204V13.9796C34.5567 13.5287 34.0841 13.1633 33.5011 13.1633H6.05559C5.47258 13.1633 5 13.5287 5 13.9796V16.0204C5 16.4713 5.47258 16.8367 6.05559 16.8367ZM33.5011 25H6.05559C5.47258 25 5 24.6345 5 24.1837V22.1429C5 21.692 5.47258 21.3265 6.05559 21.3265H33.5011C34.0841 21.3265 34.5567 21.692 34.5567 22.1429V24.1837C34.5567 24.6345 34.0841 25 33.5011 25Z"
                        fill="white"
                      />
                      <path
                        d="M12.9444 29V36H12.2344V30.4L9.48436 35.11H9.13436L6.38436 30.43V36H5.67436V29H6.28436L9.32436 34.19L12.3344 29H12.9444ZM19.7206 35.36V36H14.7706V29H19.5706V29.64H15.5106V32.13H19.1306V32.76H15.5106V35.36H19.7206ZM26.8555 29V36H26.2455L21.7455 30.32V36H21.0055V29H21.6155L26.1255 34.68V29H26.8555ZM31.5057 36.06C30.5991 36.06 29.8924 35.8 29.3857 35.28C28.8791 34.76 28.6257 34.0033 28.6257 33.01V29H29.3657V32.98C29.3657 33.7933 29.5491 34.4 29.9157 34.8C30.2824 35.2 30.8124 35.4 31.5057 35.4C32.2057 35.4 32.7391 35.2 33.1057 34.8C33.4724 34.4 33.6557 33.7933 33.6557 32.98V29H34.3757V33.01C34.3757 34.0033 34.1224 34.76 33.6157 35.28C33.1157 35.8 32.4124 36.06 31.5057 36.06Z"
                        fill="white"
                      />
                    </svg>
                  )}
                </div>
              </>
            )}
          </div>
        </div>
      </header>
    </>
  )
}

HeaderComponent.propTypes = {
  serviceName: PropTypes.string.isRequired,
  toggleMobileMenu: PropTypes.func,
}

export default HeaderComponent
